var timer=null,session=null,progressFlag=1,currentMedia=null,currentMediaURL=null,currentMediaTime=0,currentVolume=.5;chrome.cast&&chrome.cast.isAvailable||setTimeout(initializeCastApi,1E3);function initializeCastApi(){var a=new chrome.cast.SessionRequest("AC2C6EBA"),a=new chrome.cast.ApiConfig(a,sessionListener,receiverListener);chrome.cast.initialize(a,onInitSuccess,onError)}function onInitSuccess(){console.log("init success")}function onError(){console.log("error")}
function onSuccess(a){console.log(a)}function onStopAppSuccess(){console.log("Session stopped")}function sessionListener(a){session=a;console.log("New session ID: "+session.sessionId);0!=session.media.length&&(console.log("Found "+session.media.length+" existing media sessions."),onMediaDiscovered("sessionListener",session.media[0]));session.addMediaListener(onMediaDiscovered.bind(this,"addMediaListener"));session.addUpdateListener(sessionUpdateListener.bind(this))}
function sessionUpdateListener(a){console.log((a?"Session Updated":"Session Removed")+(": "+session.sessionId));a||(session=null,a=document.getElementById("playpauseresume"),a.innerHTML="Play",timer?clearInterval(timer):(timer=setInterval(updateCurrentTime.bind(this),1E3),a.innerHTML="Pause"))}function receiverListener(a){"available"===a?console.log("receiver found"):console.log("receiver list empty")}function setMyMediaURL(a){a.value&&(currentMediaURL=a.value)}
function launchApp(){console.log("launching app...");chrome.cast.requestSession(onRequestSessionSuccess,onLaunchError);timer&&clearInterval(timer)}
function onRequestSessionSuccess(a){console.log("session success: "+a.sessionId);session=a;session.addUpdateListener(sessionUpdateListener.bind(this));0!=session.media.length&&onMediaDiscovered("onRequestSession",session.media[0]);session.addMediaListener(onMediaDiscovered.bind(this,"addMediaListener"));session.addUpdateListener(sessionUpdateListener.bind(this))}function onLaunchError(){console.log("launch error")}
function stopApp(){session.stop(onStopAppSuccess,onError);timer&&clearInterval(timer)}function loadCustomMedia(){var a=document.getElementById("networkStreamUrl").value,b=document.getElementById("mediaMimeType").value;0<a.length&&loadMediaPwnt(a,b)}function playCustomMedia(){var a=document.getElementById("networkStreamUrl").value;0<a.length&&(document.location.href="player.html?video="+a)}
function setLivestream(a){if(a=["http://live-lh.daserste.de/i/daserste_de@91204/master.m3u8","http://emwdr-lh.akamaihd.net/i/em2016_wdr@182638/index_3776_av-p.m3u8?b=3667&sd=10&dw=10&rebase=on","http://zdf1314-lh.akamaihd.net/i/de14_v1@392878/index_3056_av-p.m3u8?sd=10&rebase=on","http://ran03dach-live.hls.adaptive.level3.net/sevenone/ran03dach/wifi2500.m3u8"][a])document.getElementById("networkStreamUrl").value=a,document.getElementById("mediaMimeType").selectedIndex=0}
function toHHMMSS(a){a=new Date(Math.round(100*a)/100*1E3);return("0"+a.getUTCHours()).slice(-2)+":"+("0"+a.getUTCMinutes()).slice(-2)+":"+("0"+a.getSeconds()).slice(-2)}function guessMimeType(a){-1!=a.indexOf(".mp3")?document.getElementById("mediaMimeType").selectedIndex=2:(-1!=a.indexOf(".mp4")||a.indexOf('.mkv')!=-1)?document.getElementById("mediaMimeType").selectedIndex=1:-1!=a.indexOf(".m3u8")&&(document.getElementById("mediaMimeType").selectedIndex=0)}
function loadMedia(a){if(session){a=a?a:currentMediaURL;var b=new chrome.cast.media.MediaInfo(a);console.log("loading new media file... "+a);b.contentType="video/mp4";a=new chrome.cast.media.LoadRequest(b);a.autoplay=!0;a.currentTime=0;session.loadMedia(a,onMediaDiscovered.bind(this,"loadMedia"),onMediaError)}else console.log("no session")}
function loadMediaPwnt(a,b){if(session){var c=a?a:currentMediaURL,d=new chrome.cast.media.MediaInfo(c);console.log("loading new media file... "+c);d.contentType=b;c=new chrome.cast.media.LoadRequest(d);c.autoplay=!0;c.currentTime=0;session.loadMedia(c,onMediaDiscovered.bind(this,"loadMedia"),onMediaError)}else console.log("no session")}
function onMediaDiscovered(a,b){console.log("new media session ID:"+b.mediaSessionId);currentMedia=b;currentMedia.addUpdateListener(onMediaStatusUpdate);currentMediaTime=currentMedia.currentTime;playpauseresume.innerHTML="Play";timer||(timer=setInterval(updateCurrentTime.bind(this),1E3),playpauseresume.innerHTML="Pause")}function onMediaError(a){console.log("media error")}
function onMediaStatusUpdate(a){progressFlag&&(document.getElementById("duration").innerHTML=toHHMMSS(currentMedia.media.duration),document.getElementById("progress_tick").innerHTML=toHHMMSS(currentMedia.currentTime),document.getElementById("progress").value=parseInt(100*currentMedia.currentTime/currentMedia.media.duration));document.getElementById("playerstate").innerHTML=currentMedia.playerState}
setInterval(function(){var a=document.getElementById("playpauseresume");currentMedia&&"PLAYING"==currentMedia.playerState&&"Play"==a.innerHTML&&playMedia()},1E3);
function updateCurrentTime(){if(session&&currentMedia)if(currentMedia.media&&null!=currentMedia.media.duration){var a=currentMedia.getEstimatedTime();document.getElementById("progress").value=toHHMMSS(parseInt(100*a/currentMedia.media.duration));document.getElementById("progress_tick").innerHTML=toHHMMSS(a)}else document.getElementById("progress").value=0,document.getElementById("progress_tick").innerHTML=0,timer&&clearInterval(timer)}
function playMedia(){if(currentMedia){timer&&clearInterval(timer);var a=document.getElementById("playpauseresume");"Play"==a.innerHTML?(currentMedia.play(null,mediaCommandSuccessCallback.bind(this,"playing started for "+currentMedia.sessionId),onError),console.log("playback started..."),a.innerHTML="Pause",timer=setInterval(updateCurrentTime.bind(this),1E3)):"Pause"==a.innerHTML?(currentMedia.pause(null,mediaCommandSuccessCallback.bind(this,"paused "+currentMedia.sessionId),onError),console.log("playback paused..."),
a.innerHTML="Resume"):"Resume"==a.innerHTML&&(currentMedia.play(null,mediaCommandSuccessCallback.bind(this,"resumed "+currentMedia.sessionId),onError),console.log("playback resumed..."),a.innerHTML="Pause",timer=setInterval(updateCurrentTime.bind(this),1E3))}}
function stopMedia(){currentMedia&&(currentMedia.stop(null,mediaCommandSuccessCallback.bind(this,"stopped "+currentMedia.sessionId),onError),console.log("playback stopped"),document.getElementById("playpauseresume").innerHTML="Play",timer&&clearInterval(timer))}
function setMediaVolume(a,b){if(currentMedia){var c=new chrome.cast.Volume,d=new chrome.cast.media.VolumeRequest;c.muted=b;c.level=a;d.volume=c;currentVolume=c.level;currentMedia.setVolume(d,mediaCommandSuccessCallback.bind(this,"media set-volume done"),onError)}}
function setReceiverVolume(a,b){session&&(b?session.setReceiverMuted(!0,mediaCommandSuccessCallback.bind(this,"media set-volume done"),onError):(session.setReceiverVolumeLevel(a,mediaCommandSuccessCallback.bind(this,"media set-volume done"),onError),currentVolume=a),setTimeout(function(){document.getElementById("volumething").value=100*currentVolume},300))}
function muteMedia(a){1==a.checked?(setReceiverVolume(currentVolume,!0),console.log("media muted"),a.checked=!0):(setReceiverVolume(currentVolume,!1),console.log("media unmuted"))}function seekMedia(a){console.log("Seeking "+currentMedia.sessionId+":"+currentMedia.mediaSessionId+" to "+a+"%");progressFlag=0;var b=new chrome.cast.media.SeekRequest;b.currentTime=a*currentMedia.media.duration/100;currentMedia.seek(b,onSeekSuccess.bind(this,"media seek done"),onError)}
function onSeekSuccess(a){console.log(a);setTimeout(function(){progressFlag=1},1500)}function mediaCommandSuccessCallback(a){console.log(a)};
